<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">

<!-- 전체 행의 개수 -->
	<select id="boardListCount" parameterType="java.util.Map" resultType="int">
	    select count(*) as cnt
		 FROM TB_BOARD
		where del_flg='N'   
	</select>
	
<select id="BoardList" parameterType="int" resultType="map">
select X.*
		from ( 
		    select rownum as rnum, A.*
		        from (
		SELECT
 		 *
		FROM tb_board
		WHERE ACTIVE_FLG='Y'
	    ORDER BY BOARD_NO DESC
) A
	  ) X
 <![CDATA[
		 where X.rnum > #{page.startRow} and X.rnum <= #{page.endRow}
		 
			]]>
 </select>
 
 <select id="ajaxList" resultType="com.msp.cp.board.vo.BoardVO">
 
 SELECT
  BOARD_NO, TITLE, CONTENT, CREATED_BY, to_char(CREATED, 'yy-mm-dd hh:mm' ), VIEW_CNT
FROM tb_board
WHERE ACTIVE_FLG='Y'
 </select>
 
 
 <select id="ReadPage"  resultType="com.msp.cp.board.vo.BoardVO">
 SELECT A.TITLE, A.CONTENT, A.BOARD_NO, A.CREATED, A.VIEW_CNT, B.REPLY_FLG, A.QUESTION_TYPE_CD, A.FILE_CD
 FROM TB_BOARD A, TB_BOARD_MNG B
 WHERE BOARD_NO = #{BOARD_NO} AND A.BOARD_MNG_NO = B.BOARD_MNG_NO
 </select>
 
 <select id="ReadFilePage" resultType="com.msp.cp.board.vo.BoardVO">
  SELECT A.TITLE, A.CONTENT, A.BOARD_NO, A.CREATED, A.VIEW_CNT, B.REPLY_FLG, A.QUESTION_TYPE_CD, C.FILE_CD, C.FILE_NM
 FROM TB_BOARD A, TB_BOARD_MNG B, TB_FILE C
 WHERE BOARD_NO = #{BOARD_NO} AND A.BOARD_MNG_NO = B.BOARD_MNG_NO AND A.FILE_CD = C.FILE_CD
 </select>
 
 <insert id="InsertBoard" parameterType="com.msp.cp.board.vo.BoardVO">
INSERT INTO TB_BOARD (BOARD_NO, BOARD_MNG_NO, FILE_CD, TITLE, CONTENT, VIEW_CNT, QUESTION_TYPE_CD, CREATED_BY,  UPDATED_BY)
VALUES(board_seq.nextval, 'BMG1000003',(SELECT FILE_CD FROM TB_FILE WHERE FILE_NM =#{FILE_NM}), #{TITLE}, #{CONTENT}, '1', 'abcd', '진수거', '')

 </insert>
 
 <select id="readBoard"  resultType="com.msp.cp.board.vo.BoardVO">
 
SELECT A.TITLE, A.CONTENT, A.BOARD_NO, A.CREATED, A.VIEW_CNT, B.REPLY_FLG, A.QUESTION_TYPE_CD, C.FILE_NM
 FROM TB_BOARD A, TB_BOARD_MNG B, TB_FILE C
 WHERE BOARD_NO = #{BOARD_NO} AND A.BOARD_MNG_NO = B.BOARD_MNG_NO AND C.FILE_CD = A.FILE_CD
 
 </select>
 
 <update id="removeBoard" parameterType="String" > 
 update tb_board set active_flg = 'N'
 	where BOARD_NO = #{BOARD_NO}
 </update>
 
 <update id="ModifyBoard" >
 
 update tb_board set title = #{TITLE}, content = #{CONTENT}
 where BOARD_NO = #{BOARD_NO} 
 </update>
 
 
 <select id="QnAList" resultType="map">
SELECT A.BOARD_NO, A.QUESTION_TYPE_CD, A.ANSWER_FLG, A.TITLE, A.CONTENT, A.CREATED_BY, A.CREATED, A.VIEW_CNT, B.BOARD_MNG_NO
FROM tb_board A, TB_BOARD_MNG B
WHERE A.BOARD_MNG_NO = B.BOARD_MNG_NO  AND B.BOARD_MNG_CD = 'BG03'
 
 
 </select>
 
 
 <select id="QnACount" parameterType="java.util.Map" resultType="int" >
    SELECT COUNT(*) AS CNT
	FROM TB_BOARD
	WHERE DEL_FLG = 'N'
	<if test="qna_answer != null and qna_answer != '' ">   
		AND ANSWER_FLG = #{qna_answer}
	</if>
	
	<if test="keyword != null and keyword != ''">   
   		AND TITLE LIKE '%'||#{keyword}||'%' 
    </if>
 </select>
 
 
 
 <select id="selectQnA"  parameterType="map" resultType="com.msp.cp.board.vo.BoardVO">
SELECT X.*
FROM ( SELECT ROWNUM AS RNUM, A.*
       FROM (
         SELECT *
         FROM TB_BOARD
         WHERE 
         	DEL_FLG = 'N'
       	 	<if test="active_key != null and active_key != '' " >   
            	AND ANSWER_FLG = #{active_key}
		 	</if>
		 	<if test="keyword != null and keyword != ''" >   
            	AND TITLE LIKE '%' || #{keyword} || '%'
         	</if>
         ORDER BY BOARD_NO ASC ) A
     ) X
     <![CDATA[
        WHERE X.RNUM >= #{startRow} AND X.RNUM <= #{endRow}
	 ]]>
</select>

 <select id="SearchList"  parameterType="map" resultType="com.msp.cp.board.vo.BoardVO">
SELECT X.*
FROM ( SELECT ROWNUM AS RNUM, A.*
       FROM (
         SELECT *
         FROM TB_BOARD
         WHERE 
         	DEL_FLG = 'N' AND BOARD_MNG_NO = 'BMG1000002'
       	 	<if test="active_key != null and active_key != '' " >   
            	AND ANSWER_FLG = #{active_key}
		 	</if>
		 	<if test="keyword != null and keyword != ''" >   
            	AND TITLE LIKE '%' || #{keyword} || '%'
         	</if>
         ORDER BY BOARD_NO ASC ) A
     ) X
     <![CDATA[
        WHERE X.RNUM >= #{startRow} AND X.RNUM <= #{endRow}
	 ]]>
</select>




 	<insert id="insertAttachData" parameterType="com.msp.cp.board.vo.BoardVO">
	
	insert into TB_FILE (FILE_CD, FILE_NO, FILE_PATH, FILE_NM, FILE_EXT, CREATED_BY)
values (
  (
    SELECT /*+INDEX_DESC(TB_FILE TB_FILE)*/
      DECODE(MAX(FILE_CD), NULL, 'FIL1000001', SUBSTR(MAX(FILE_CD), 1, 3) || (SUBSTR(MAX(FILE_CD), 4, 7)+1)) FILE_CD
    FROM TB_FILE
     <![CDATA[
    WHERE FILE_CD < CONCAT('FIL', '9999999')
          AND ROWNUM = 1
          	]]>
   ), 
   FILE_SEQ.NEXTVAL,
   #{FILE_PATH},
   #{FILE_NM}, 
   #{FILE_EXT}, 
    'ADMIN' 
)
 
	</insert>  
	
	<select id="searchOneFiledata" parameterType="java.lang.String" resultType="java.util.Map">
	
	SELECT FILE_PATH
	FROM TB_FILE
	WHERE FILE_CD=#{FILE_CD}
	
	</select>
 

</mapper>
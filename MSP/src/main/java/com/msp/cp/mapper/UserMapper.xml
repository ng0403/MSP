<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="user">

	<select id="searchListUser" parameterType="string" resultType="map">
		SELECT *
		FROM TB_USER
		where active_flg='Y'
	</select>

	<insert id="userInsert" parameterType="com.msp.cp.user.vo.userVO">
		INSERT INTO tb_user (
			user_id, user_pwd, emp_no, user_nm, dept_cd
			, rank_cd, duty_cd, cphone_num1, cphone_num2, cphone_num3
			, phone_num1, phone_num2, phone_num3, email_id, email_domain
			, hiredate, created_by
			)
			VALUES (
					#{user_id},
					#{user_pwd},
					(<![CDATA[
						SELECT /*+INDEX_DESC(TB_USER IDX_EMP_NO)*/
						DECODE(SUBSTR(MAX(emp_no), 1, 6)
						, TO_CHAR(SYSDATE, 'YYYYMM')
						, MAX(emp_no)+1
						, TO_CHAR(SYSDATE,'YYYYMM')||'0001')emp_no
						FROM tb_user
						WHERE emp_no < TO_CHAR(SYSDATE, 'YYYYMM')||'9999'
						AND ROWNUM = 1)]]>,
					#{user_nm},
					#{dept_cd},
					#{rank_cd},
					#{duty_cd},
					#{cphone_num1},
					#{cphone_num2},
					#{cphone_num3},
					#{phone_num1},
					#{phone_num2},
					#{phone_num3},
					#{email_id},
					#{email_domain},
					'12345',
					'admin'
		)
	</insert>

	<update id="userDel" parameterType="com.msp.cp.user.vo.userVO">
		UPDATE tb_user
		SET ACTIVE_FLG = 'N'
		where user_id = #{user_id}
	</update>

	<select id="userDetail" parameterType="string"
		resultType="com.msp.cp.user.vo.userVO">
		SELECT
		*
		FROM
		TB_USER
		WHERE
		USER_ID = #{user_id}
		AND ACTIVE_FLG = 'Y'
	</select>

	<update id="userEdit" parameterType="com.msp.cp.user.vo.userVO">
		UPDATE
		TB_USER
		SET
		user_nm=#{user_nm}
		,user_pwd=#{user_pwd}
		,email_id=#{email_id}
		,email_domain=#{email_domain}
		,cphone_num1=#{cphone_num1}
		,cphone_num2=#{cphone_num2}
		,cphone_num3=#{cphone_num3}
		,phone_num1=#{phone_num1}
		,phone_num2=#{phone_num2}
		,phone_num3=#{phone_num3}
		,dept_cd=#{dept_cd}
		,rank_cd=#{rank_cd}
		,duty_cd=#{duty_cd}

		WHERE
		user_id = #{user_id}
	</update>
</mapper>